<% const folderHasSubfolders = folder.subfolders.length > 0; %>
<% const folderHasFiles = folder.files.length > 0; %>
<% const isFolderEmpty = !folderHasSubfolders && !folderHasFiles; %>

<!DOCTYPE html>
<html lang="en">
<%- include('../partials/head', { title: 'Folder' }) %>
<body class="bg-sky-200 min-h-screen flex flex-col">
  <%- include('../partials/header') %>
  <main>
    <div class="w-4/5 max-w-7xl mx-auto">
      <div class="grid grid-cols-value-[1fr auto]">
        <h1 class="text-2xl text-neutral-800 my-4">üìÅ <%= folder.name %></h2>

        <nav class="col-2 my-4 justify-self-end">
          <button onclick="(() => {document.querySelector('#rename-form').classList.toggle('hidden')})()">
            <svg class="w-6 cursor-pointer fill-amber-500 hover:fill-amber-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <title>Rename folder</title>
              <path class="fill-inherit" d="M15 16L11 20H21V16H15M12.06 7.19L3 16.25V20H6.75L15.81 10.94L12.06 7.19M18.71 8.04C19.1 7.65 19.1 7 18.71 6.63L16.37 4.29C16.17 4.09 15.92 4 15.66 4C15.41 4 15.15 4.1 14.96 4.29L13.13 6.12L16.88 9.87L18.71 8.04Z" />
            </svg>
          </button>
          <button onclick="(() => {document.querySelector('#folder-form').classList.toggle('hidden')})()">
            <svg class="w-6 cursor-pointer fill-amber-500 hover:fill-amber-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <title>Add Folder</title>
              <path class="fill-inherit" d="M13 19C13 19.34 13.04 19.67 13.09 20H4C2.9 20 2 19.11 2 18V6C2 4.89 2.89 4 4 4H10L12 6H20C21.1 6 22 6.89 22 8V13.81C21.12 13.3 20.1 13 19 13C15.69 13 13 15.69 13 19M20 18V15H18V18H15V20H18V23H20V20H23V18H20Z" />
            </svg>
          </button>
          <button onclick="(() => {document.querySelector('#file-form').classList.toggle('hidden')})()">
            <svg class="w-6 cursor-pointer fill-amber-500 hover:fill-amber-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <title>Add file</title>
              <path class="fill-inherit" d="M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z" />
            </svg>
          </button>
        </nav>

        <div class="col-span-2">
          <%- include('../partials/folder-form') %>
        </div>

        <div class="col-span-2">
          <%- include('../partials/file-form') %>
        </div>

        <div class="col-span-2">
          <%- include('../partials/rename-form') %>
        </div>

        <table class="col-span-2 text-neutral-700 bg-sky-300 shadow-md my-4">
          <tr class="text-neutral-800 text-left odd:bg-sky-400">
            <th class="px-2 py-1">type</th>
            <th class="px-2 py-1">name</th>
            <th class="px-2 py-1">actions</th>
          </tr>
          <% if (folderHasSubfolders) { %>
            <% folder.subfolders.forEach((subfolder) => { %>
              <tr class="odd:bg-sky-400">
                <td class="px-2 py-1 w-4">üìÅ</td>
                <td class="px-2 py-1">
                  <a href="/drive/<%= subfolder.id %>" class="text-neutral-800 hover:text-sky-800">
                    <%= subfolder.name %>
                  </a>
                </td>
                <td class="px-2 py-1">
                  <form action="/drive/delete/<%= subfolder.id %>" method="post">
                    <button class="block">
                      <svg class="w-6 cursor-pointer fill-amber-500 hover:fill-amber-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <title>Delete</title>
                        <path class="fill-inherit" d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" />
                      </svg>
                    </button>
                  </form>
                </td>
              </tr>
            <% }) %>
          <% } %>
          
          <% if (folderHasFiles) { %>
            <% folder.files.forEach((file) => { %>
              <tr class="odd:bg-sky-400">
                <td class="px-2 py-1 w-4">üìÑ</td>
                <td class="px-2 py-1">
                  <a href="/file/<%= file.id %>" class="text-neutral-800 hover:text-sky-800">
                    <%= file.name %>
                  </a>
                </td>
                <td class="px-2 py-1">
                  <form action="/file/delete/<%= file.id %>" method="post">
                    <button class="block">
                      <svg class="w-6 cursor-pointer fill-amber-500 hover:fill-amber-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <title>Delete</title>
                        <path class="fill-inherit" d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" />
                      </svg>
                    </button>
                  </form>
                </td>
              </tr>
            <% }) %>
          <% } %>
        </table>
      </div>
      
      <% if (isFolderEmpty) { %>
        <p class="text-neutral-700 text-lg">Folder is empty</p>
      <% } %>
    </div>
  </main>
  <%- include('../partials/footer') %>
</body>
</html>